#
# MapServer Mapfile
#
# Test requests:
#
# WMS GetCapabilities:
# /mapserv?service=wms&version=1.1.1&request=getcapabilities
#
# WMS GetMap:
# /mapserv?service=wms&version=1.1.1&request=getmap&bbox=-180,-90,180,90&layers=countries&width=600&height=400&srs=EPSG:4326&format=image/png
#
# WMS GetFeatureInfo:
# /mapserv?service=wms&version=1.1.1&request=getfeatureinfo&bbox=-180,-90,180,90&layers=countries&query_layers=countries&width=600&height=400&srs=EPSG:4326&format=image/png&x=180&y=90&info_format=application/vnd.ogc.gml
#

MAP
    NAME "geoportal"

    EXTENT -1016446 5017723 1592763 6676365
    UNITS METERS

    # RESOLUTION and DEFRESOLUTION default to 72. If you
    # change RESOLUTION to some other value, also change
    # DEFRESOLUTION. See
    # http://mapserver.org/development/rfc/ms-rfc-55.html
    RESOLUTION 72 ## Also set in Openlayers for especially legends
    DEFRESOLUTION 72

    # MAXSIZE shouldn't be less than 5000 for MF print on A3
    MAXSIZE 5000

    SHAPEPATH '/var/sig/demo/c2cgeoportal'

    IMAGECOLOR 255 255 255
    STATUS ON

    FONTSET "fonts.conf"
    SYMBOLSET "symbols.sym"

    OUTPUTFORMAT
        NAME jpeg
        DRIVER "AGG/JPEG"
        MIMETYPE "image/jpeg"
        IMAGEMODE RGB
        EXTENSION "jpeg"
        FORMATOPTION "QUALITY=75,PROGRESSIVE=TRUE"
    END

    OUTPUTFORMAT
        NAME png
        DRIVER AGG/PNG
        MIMETYPE "image/png"
        IMAGEMODE RGBA
        EXTENSION "png"
        FORMATOPTION "INTERLACE=OFF"
        FORMATOPTION "QUANTIZE_DITHER=OFF"
        FORMATOPTION "QUANTIZE_FORCE=ON"
        FORMATOPTION "QUANTIZE_COLORS=256"
    END

    PROJECTION
        "init=epsg:3857"
    END

    WEB
        METADATA
            "wms_title" "Démo du c2cgeoportal"
            "wms_abstract" "Des exemples de couches à partir de données OpenData de différentes villes françaises et suisse."
            "wms_onlineresource" "http://${host}/${instanceid}/wsgi/mapserv_proxy"
            "wms_srs" "epsg:3857"
            "wms_encoding" "UTF-8"
            "wms_enable_request" "*"
            "wfs_enable_request" "*"
            "wfs_encoding" "UTF-8"
        END
    END

    LEGEND
        LABEL
            ENCODING "UTF-8"
            TYPE TRUETYPE
            FONT "Arial"
            SIZE 9
        END
    END

    # OSM
    INCLUDE "osm.map"
    INCLUDE "edit.map"

    # Montpellier
    INCLUDE "montpellier/administration.map"
    INCLUDE "montpellier/equipement.map"
    INCLUDE "montpellier/paysage.map"
    INCLUDE "montpellier/environnement.map"
    INCLUDE "montpellier/patrimoine.map"
    INCLUDE "montpellier/planville.map"

    #CG67
    INCLUDE "cg67/cadastre.map"
    INCLUDE "cg67/enseignement.map"
    INCLUDE "cg67/transport.map"
    INCLUDE "cg67/administration.map"

    LAYER
      NAME "Departements"
      GROUP "plan"
      STATUS ON
      DATA ign/departement_3857.shp
      TYPE POLYGON 
      PROJECTION
        "init=epsg:3857"
      END
      SYMBOLSCALEDENOM 450000
      CLASS
        NAME "Départements"
        STYLE
           OUTLINECOLOR 200 200 200
           COLOR 100 100 100
           WIDTH 3
           MAXWIDTH 3
           MINWIDTH 1
  
        END
     END
      METADATA
          "wms_title" "Departements" # For WMS
          "wms_group_title" "plan"
          "wms_srs" "epsg:3857" # For WMS
      END
    END

  LAYER
    NAME "communes"
    GROUP "plan"
    STATUS ON
    TYPE POLYGON
    DATA ign/commune_3857.shp
    PROJECTION
      "init=epsg:3857"
    END
    MAXSCALEDENOM 400001
    LABELMINSCALEDENOM 30000
    LABELITEM "NOM_COMM"
    CLASS
      NAME "Commune"
      EXPRESSION ([SUPERFICIE] < 4000)
      STYLE
         OUTLINECOLOR 200 200 200
         COLOR -1 -1 -1
         WIDTH 0.5
      END
    END
    CLASS
      EXPRESSION ([SUPERFICIE] >= 4000)
      STYLE
         OUTLINECOLOR 200 200 200
         COLOR -1 -1 -1
         WIDTH 0.5
      END
      LABEL
        SIZE 8
        FONT arial
        TYPE truetype
        COLOR  150 150 150
      END
    END

    METADATA
        "wms_title" "Communes" # For WMS
        "wms_group_title" "plan"
        "wms_srs" "epsg:3857" # For WMS
    END
  END


  LAYER
        NAME "relief_france"
        GROUP "relief"
        #DEBUG 5
        STATUS ON
        TYPE RASTER
        DATA /var/sig/demo/c2cgeoportal/ign/mnt_france_relief.tif
        PROCESSING "OVERSAMPLE_RATIO=1"
        PROCESSING "RESAMPLE=BILINEAR"
        PROJECTION
           "init=epsg:2154"
        END
        METADATA
          "wms_title" "Relief map for local off line service" # For WMS
          "wms_group_title" "plan"
          "wms_srs" "epsg:3857" # For WMS
        END
   END

#  LAYER
#       NAME "ortho_world"  
#       GROUP "ortho"
#       #DEBUG 5
#       STATUS ON
#       TYPE RASTER
#       DATA /var/sig/demo/c2cgeoportal/Ortho/mapbox_900913.xml 
#       PROCESSING "OVERSAMPLE_RATIO=1"
#       PROCESSING "RESAMPLE=BILINEAR"
#       PROJECTION
#          "init=epsg:3857"
#       END
#       METADATA
#         "wms_title" "Ortho mondial mapbox" # For WMS
#         "wms_group_title" "ortho"
#         "wms_srs" "epsg:3857" # For WMS
#       END
#
#  END

  LAYER
        NAME "ortho_world_bluemarble"
        GROUP "ortho"
        #DEBUG 5
        STATUS ON
        TYPE RASTER
        TILEINDEX Ortho/bm/tindex.shp
        PROCESSING "OVERSAMPLE_RATIO=1"
        PROCESSING "RESAMPLE=BILINEAR"
        PROJECTION
           "init=epsg:4326"
        END
        METADATA
          "wms_title" "Ortho Blue Marble Next Generation NASA" # For WMS
          "wms_group_title" "ortho"
          "wms_srs" "epsg:3857" # For WMS
        END
   END

END
